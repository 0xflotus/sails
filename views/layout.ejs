<!DOCTYPE html>
<html>
	<head>
		<title><%- title %></title>
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		
		<link rel="stylesheet" type="text/css" media="all" href="/stylesheets/reset.css"/>
		<link rel="stylesheet" type="text/css" media="all" href="/stylesheets/layout.css"/>
		<link rel="stylesheet" type="text/css" media="all" href="/stylesheets/responsive.css"/>
		
		<!-- Compiled component styles -->
		<link rel="stylesheet" type="text/css" media="all" href="/stylesheets/_components.css"/>
		

		<!-- 3rd Party Dependencies -->
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js"></script>
		
		<!-- Compiled socket.io SDK -->
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		

		<!-- Compiled mast library and controller -->
<!--		<script type="text/javascript" src="/js/mast.min.js"></script>-->
		
		<!-- Compiled app logic -->
		<script type="text/javascript" src="/js/_app.js"></script>

	</head>
	<body>
		<div id="topbar">
			<h1 id="branding">
				<a href="/">sails.js</a>
			</h1>

			<% 
				var authedNavbar = [
					 {label: "Logout", href:"/logout"}
				],
					unauthedNavbar = [
					 {label: "Login", href:"/login"}
					,{label: "Register", href:"/register"}
					,{label: "Register as Admin", href:"/auth/registerAdmin"}
				];
			%>
			
			<ul class="widescreen-nav">
				<% _.each((session.authenticated) ? authedNavbar : unauthedNavbar,
						function(item) { %>
				<li><a href="<%- item['href'] %>"><%- item['label'] %></a></li>
					<% }); %>
			</ul>
			
			<select class="mobile-only" id="topbar-dropdown">
				<option>-- Go --</option>
			<% _.each((session.authenticated) ? authedNavbar : unauthedNavbar,
						function(item) { %>
				<option href="<%- item['href'] %>"><%- item['label'] %></option>
					<% }); %>
			</select>
			<script type="text/javascript">
				// Handle mobile navbar
				$(function(){
					$("#topbar-dropdown").change(function (e) {
						var destination = $(e.currentTarget).find("option:selected").attr('href');
						window.location = destination;
					});
				});
			</script>

		</div>

		<div id="content">
			<%- body %>
		</div>

		
		<div style="display:none;" id="mast-template-library">
			<%
			// Get all files in components dir
			var viewRelativePath = "../components", 
				appRelativePath = 'components';
			fs.readdirSync(appRelativePath).forEach(function(filename) {

				// TODO: Efficient compilation, see https://github.com/balderdashdesign/mast/issues/5
				// TODO: + JS and CSS compilation, see https://github.com/balderdashdesign/mast/issues/5
				// TODO: Evaluate filename parsing convention, see https://github.com/balderdashdesign/mast/issues/5
			
				if ((filename === 'index.js') || (filename[0] === '_')) { return; }

				filename = path.basename(filename, path.extname(filename));
				var filepath = path.join(viewRelativePath, filename);

				%>
				<%- partial(filepath,{}) %>
			<% }); %>
		</div>
		
		<div id="footer">
			<a target="_blank" href="http://sailsjs.com" class="copyright">&copy; Mast Framework 2012</a>
		</div>
	</body>
</html>
