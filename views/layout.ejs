<!DOCTYPE html>
<html>
	<head>
		<title><%- title %></title>
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		
		<!-- Good old fashioned CSS -->
		<link rel="stylesheet" type="text/css" media="all" href="/stylesheets/reset.css"/>
		<link rel="stylesheet" type="text/css" media="all" href="/stylesheets/layout.css"/>
		
		
		<!-- Import template styles -->
		<% if(config.appEnvironment=='production') { %>
			<link rel="stylesheet" type="text/css" media="all" href="/_target/app.css"/>
		<% } else { %>
			
		<% } %>
		
		
		
		<!-- TODO: include 3rd party dependencies as part of production minification process -->
		<!-- BUT ONLY IF THEY'RE NOT ALREADY IN THE DOM!!!! -->
		<!-- Important component and route logic -->
		<!-- 3rd Party Dependencies -->
<!--		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.8.19/jquery-ui.min.js"></script>
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js"></script>-->
		<!-- TODO: copy socket.io into the lib/client dir automatically on app start and bundle it as part of the compilation process -->
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		
		<% if(config.appEnvironment=='production') { %>

			<script type="text/javascript" src="/_target/app.js"></script>
		<% } else { %>
			// Get all of the necessary scripts
			
		<% } %>
		
		
		
	</head>
	<body>
		<div id="topbar">
			<h1 id="branding">
				<a href="/">sails.js</a>
			</h1>

			<!-- Turn this into a proper component -->
			<% 
				var authedNavbar = [
					 {label: "Logout", href:"/logout"}
				],
					unauthedNavbar = [
					 {label: "Login", href:"/login"}
					,{label: "Register", href:"/register"}
					,{label: "Register as Admin", href:"/auth/registerAdmin"}
				];
			%>
			
			<ul class="widescreen-nav">
				<% _.each((session.authenticated) ? authedNavbar : unauthedNavbar,
						function(item) { %>
				<li><a href="<%- item['href'] %>"><%- item['label'] %></a></li>
					<% }); %>
			</ul>
			
			<select class="mobile-only" id="topbar-dropdown">
				<option>-- Go --</option>
			<% _.each((session.authenticated) ? authedNavbar : unauthedNavbar,
						function(item) { %>
				<option href="<%- item['href'] %>"><%- item['label'] %></option>
					<% }); %>
			</select>
			<script type="text/javascript">
				// Handle mobile navbar
				$(function(){
					$("#topbar-dropdown").change(function (e) {
						var destination = $(e.currentTarget).find("option:selected").attr('href');
						window.location = destination;
					});
				});
			</script>

		</div>

		<div id="content">
			<%- body %>
		</div>

		<!-- TODO: Move this into a view partial -->
		<div style="display:none;" id="mast-template-library">
			<%
			// Get all files in components dir
			var viewRelativePath = "../mast/components", 
				appRelativePath = 'mast/components';
			fs.readdirSync(appRelativePath).forEach(function(filename) {
			
				if (filename[0] === '_') { return; }
				var filepath = path.join(viewRelativePath, filename);

				%>
				<%- partial(filepath,{}) %>
			<% }); %>
		</div>
		
		<div id="footer">
			<a target="_blank" href="http://sailsjs.com" class="copyright">&copy; Mast Framework 2012</a>
		</div>
	</body>
</html>
